# -*- coding: utf-8 -*-
"""paper-trading-bot.

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/1QuElFXeJr_3RDszt6_q65t4y8AccjYlG
"""

import pandas as pd
import numpy as np
import yfinance as yf

class PaperTradingAgent:
    def __init__(self, symbol, initial_balance):
        self.symbol = symbol
        self.initial_balance = initial_balance
        self.balance = initial_balance
        self.positions = {}
        self.trade_history = []

    def get_historical_data(self):
        data = yf.download(self.symbol, period='1y')
        return data

    def calculate_indicators(self, data):
        data['SMA_50'] = data['Close'].rolling(window=50).mean()
        data['SMA_200'] = data['Close'].rolling(window=200).mean()
        return data.dropna()  # Remove NaN values

    def generate_signals(self, data):
        data['Signal'] = np.where(data['SMA_50'] > data['SMA_200'], 1, -1)
        return data['Signal'].tolist()

    def execute_trades(self, signals, data):
        for i in range(len(signals)):
            close_price = data['Close'].iloc[i]

            if signals[i] == 1 and self.balance >= close_price:  # Ensure sufficient funds
                shares_to_buy = int(self.balance / close_price)
                if shares_to_buy > 0:  # Avoid buying 0 shares
                    self.positions[self.symbol] = shares_to_buy
                    self.balance -= shares_to_buy * close_price
                    self.trade_history.append(("BUY", shares_to_buy, close_price))
                    print(f'Buy {shares_to_buy} shares of {self.symbol} at ${close_price:.2f}')

            elif signals[i] == -1 and self.positions.get(self.symbol, 0) > 0:
                shares_to_sell = self.positions[self.symbol]
                self.balance += shares_to_sell * close_price
                del self.positions[self.symbol]
                self.trade_history.append(("SELL", shares_to_sell, close_price))
                print(f'Sell {shares_to_sell} shares of {self.symbol} at ${close_price:.2f}')

    def run_backtest(self):
        print(f'Running backtest for {self.symbol}')
        historical_data = self.get_historical_data()
        indicator_data = self.calculate_indicators(historical_data)
        signals = self.generate_signals(indicator_data)
        self.execute_trades(signals, indicator_data)
        print(f'Final Balance: ${self.balance:.2f}')

# Example usage:
ticker_symbol = 'AAPL'
agent = PaperTradingAgent(ticker_symbol, 10000)
agent.run_backtest()

import pandas as pd
import numpy as np
import yfinance as yf

class PaperTradingAgent:
    def __init__(self, symbol, initial_balance):
        self.symbol = symbol
        self.initial_balance = initial_balance
        self.balance = initial_balance
        self.positions = {}
        self.trade_history = []

    def get_historical_data(self):
        data = yf.download(self.symbol, period='1y')
        return data

    def calculate_indicators(self, data):
        data['SMA_50'] = data['Close'].rolling(window=50).mean()
        data['SMA_200'] = data['Close'].rolling(window=200).mean()
        return data.dropna()  # Remove NaN values

    def generate_signals(self, data):
        data['Signal'] = np.where(data['SMA_50'] > data['SMA_200'], 1, -1)
        return data['Signal'].tolist()

    def execute_trades(self, signals, data):
        for i in range(len(signals)):
            close_price = data['Close'].iloc[i].item()  # Ensure it's a scalar value

            if signals[i] == 1 and self.balance >= close_price:  # Ensure sufficient funds
                shares_to_buy = int(self.balance / close_price)
                if shares_to_buy > 0:  # Avoid buying 0 shares
                    self.positions[self.symbol] = shares_to_buy
                    self.balance -= shares_to_buy * close_price
                    self.trade_history.append(("BUY", shares_to_buy, close_price))
                    print(f'Buy {shares_to_buy} shares of {self.symbol} at ${close_price:.2f}')

            elif signals[i] == -1 and self.positions.get(self.symbol, 0) > 0:
                shares_to_sell = self.positions[self.symbol]
                self.balance += shares_to_sell * close_price
                del self.positions[self.symbol]
                self.trade_history.append(("SELL", shares_to_sell, close_price))
                print(f'Sell {shares_to_sell} shares of {self.symbol} at ${close_price:.2f}')

    def run_backtest(self):
        print(f'Running backtest for {self.symbol}')
        historical_data = self.get_historical_data()
        indicator_data = self.calculate_indicators(historical_data)
        signals = self.generate_signals(indicator_data)
        self.execute_trades(signals, indicator_data)
        print(f'Final Balance: ${self.balance:.2f}')

# Example usage:
ticker_symbol = 'AAPL'
agent = PaperTradingAgent(ticker_symbol, 10000)
agent.run_backtest()
